<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Naija Market - Admin Orders</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background: #f9f9f9; margin:0; padding:2rem; }
h1 { text-align:center; color:#008753; margin-bottom:2rem; }
table { width:100%; border-collapse: collapse; background:white; box-shadow:0 4px 6px rgba(0,0,0,0.1); border-radius:8px; overflow:hidden; }
th, td { padding:0.75rem 1rem; text-align:left; border-bottom:1px solid #eee; }
th { background-color:#008753; color:white; }
tr:last-child td { border-bottom:none; }
.items-list { max-width:300px; }
.paid { color:green; font-weight:bold; }
.unpaid { color:red; font-weight:bold; }
#login-container { max-width:400px; margin: 5rem auto; padding:2rem; background:white; box-shadow:0 4px 6px rgba(0,0,0,0.1); border-radius:8px; text-align:center; }
input { width:100%; padding:0.5rem; margin:0.5rem 0; border-radius:4px; border:1px solid #ccc; }
button { padding:0.5rem 1rem; background:#008753; color:white; border:none; border-radius:4px; cursor:pointer; }
button:hover { background:#1EB53A; }
</style>
</head>
<body>

<div id="login-container">
    <h2>Admin Login</h2>
    <input type="password" id="admin-password" placeholder="Enter admin password">
    <button id="login-btn">Login</button>
    <p id="login-error" style="color:red;"></p>
</div>

<div id="orders-container" style="display:none;">
    <h1>Naija Market - Orders Dashboard</h1>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Email</th>
                <th>Items</th>
                <th>Total (₦)</th>
                <th>Paid</th>
                <th>Reference</th>
            </tr>
        </thead>
        <tbody id="orders-table-body">
            <tr><td colspan="6" style="text-align:center;">Loading orders...</td></tr>
        </tbody>
    </table>
</div>

<script>
const BACKEND_URL = 'https://naijamarket-gtv0.onrender.com/'; // Render backend

document.getElementById('login-btn').addEventListener('click', async () => {
    const password = document.getElementById('admin-password').value;
    const tbody = document.getElementById('orders-table-body');
    const loginError = document.getElementById('login-error');

    try {
        const res = await fetch(`${BACKEND_URL}/api/orders`, {
            headers: { 'x-admin-password': password }
        });

        if (res.status === 401) {
            loginError.textContent = 'Incorrect password';
            return;
        }

        const orders = await res.json();
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('orders-container').style.display = 'block';

        tbody.innerHTML = '';

        if (!orders.length) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No orders yet</td></tr>';
            return;
        }

        orders.forEach(order => {
            const tr = document.createElement('tr');
            const items = order.cart.map(i => `${i.name} x ${i.quantity}`).join(', ');
            tr.innerHTML = `
                <td>${new Date(order.date).toLocaleString()}</td>
                <td>${order.email}</td>
                <td class="items-list">${items}</td>
                <td>₦${order.totalAmount.toLocaleString()}</td>
                <td class="${order.paid ? 'paid' : 'unpaid'}">${order.paid ? 'Yes' : 'No'}</td>
                <td>${order.reference}</td>
            `;
            tbody.appendChild(tr);
        });

    } catch (err) {
        console.error(err);
        loginError.textContent = 'Error fetching orders';
    }
});
</script>

</body>
</html>
